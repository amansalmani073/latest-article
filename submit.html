<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Your Blog | Global Travel Guide</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://cdn.ckeditor.com/ckeditor5/40.0.0/classic/ckeditor.js"></script>

    <style>
        :root { --primary-color: #ff5722; --dark-color: #1a1a1a; --light-bg: #f5f7fa; }
        body { font-family: 'Poppins', sans-serif; background: var(--light-bg); padding: 50px 20px; }
        .form-container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
        .submit-btn { background: var(--primary-color); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; margin-top: 20px; }
        .submit-btn:hover { background: #e64a19; }
        .back-link { display: block; text-align: center; margin-top: 20px; text-decoration: none; color: #666; font-size: 14px; }
        /* Editor height fix */
        .ck-editor__editable { min-height: 300px; border-radius: 0 0 8px 8px !important; }
    </style>
</head>
<body>

<div class="form-container">
    <h2 style="text-align: center; color: var(--dark-color); margin-bottom: 20px;">Share Your Travel Story</h2>
    <form id="postForm">
        <input type="text" id="title" placeholder="Article Title (e.g. My Trip to Dubai)" required>
        <input type="text" id="author" placeholder="Your Name" required>
        
        <div id="editor"></div>
        
        <button type="submit" class="submit-btn">Publish My Blog</button>
    </form>
    <a href="/latest-article/" class="back-link">‚Üê Back to Home</a>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCBSTMLjE8h9saIldRcuKbaKp84t5hx9s",
    authDomain: "latest-article.firebaseapp.com",
    projectId: "latest-article",
    storageBucket: "latest-article.firebasestorage.app",
    messagingSenderId: "222132959003",
    appId: "1:222132959003:web:a329d719efb6cf7c105be",
    measurementId: "G-7635RMNN90"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Initialize CKEditor
  let blogEditor;
  ClassicEditor
    .create(document.querySelector('#editor'), {
        placeholder: 'Write your full travel guide or experience here...'
    })
    .then(editor => {
        blogEditor = editor;
    })
    .catch(error => {
        console.error(error);
    });

  document.getElementById('postForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = e.target.querySelector('button');
    
    // CKEditor se content lene ke liye getData() method use karein
    const blogContent = blogEditor.getData();

    if (!blogContent || blogContent.trim() === "") {
        alert("Please write something in the content area.");
        return;
    }

    btn.innerText = "Publishing...";
    btn.disabled = true;

    try {
      await addDoc(collection(db, "user_blogs"), {
        title: document.getElementById('title').value,
        author: document.getElementById('author').value,
        content: blogContent,
        timestamp: serverTimestamp()
      });
      
      alert("thank you!.");
      window.location.href = "/latest-article/"; 
    } catch (err) {
      alert("Error: " + err.message);
      btn.disabled = false;
      btn.innerText = "Publish My Blog";
    }
  });
</script>

</body>
</html>
